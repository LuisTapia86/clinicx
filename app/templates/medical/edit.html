{% extends "base/base.html" %}

{% block title %}Edit Medical Record - {{ record.patient.full_name }}{% endblock %}

{% block content %}
<!--
    Edit Medical Record Page
    Purpose: Update existing medical record
    Note: Similar to create.html but with pre-populated values
-->

<div class="container">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('patients.index') }}">Patients</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('patients.view', patient_id=record.patient_id) }}">{{ record.patient.full_name }}</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('medical.patient_records', patient_id=record.patient_id) }}">Medical Records</a></li>
                    <li class="breadcrumb-item active">Edit Record #{{ record.id }}</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2"><i class="bi bi-pencil"></i> Edit Medical Record</h1>
                <a href="{{ url_for('medical.view', record_id=record.id) }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back
                </a>
            </div>

            <form method="POST" action="{{ url_for('medical.edit', record_id=record.id) }}">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white"><h5 class="mb-0">Visit Information</h5></div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="visit_reason" class="form-label">Visit Reason <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="visit_reason" name="visit_reason" value="{{ record.visit_reason }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="symptoms" class="form-label">Symptoms</label>
                            <textarea class="form-control" id="symptoms" name="symptoms" rows="3">{{ record.symptoms or '' }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label for="diagnosis" class="form-label">Diagnosis <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="diagnosis" name="diagnosis" rows="3" required>{{ record.diagnosis }}</textarea>
                        </div>
                        <div class="mb-0">
                            <label for="treatment" class="form-label">Treatment Plan</label>
                            <textarea class="form-control" id="treatment" name="treatment" rows="3">{{ record.treatment or '' }}</textarea>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-success text-white"><h5 class="mb-0">Vital Signs</h5></div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="temperature" class="form-label">Temperature (Â°C)</label>
                                <input type="number" step="0.1" class="form-control" id="temperature" name="temperature" value="{{ record.temperature or '' }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="blood_pressure_systolic" class="form-label">BP Systolic</label>
                                <input type="number" class="form-control" id="blood_pressure_systolic" name="blood_pressure_systolic" value="{{ record.blood_pressure_systolic or '' }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="blood_pressure_diastolic" class="form-label">BP Diastolic</label>
                                <input type="number" class="form-control" id="blood_pressure_diastolic" name="blood_pressure_diastolic" value="{{ record.blood_pressure_diastolic or '' }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="heart_rate" class="form-label">Heart Rate (BPM)</label>
                                <input type="number" class="form-control" id="heart_rate" name="heart_rate" value="{{ record.heart_rate or '' }}">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="respiratory_rate" class="form-label">Respiratory Rate</label>
                                <input type="number" class="form-control" id="respiratory_rate" name="respiratory_rate" value="{{ record.respiratory_rate or '' }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="oxygen_saturation" class="form-label">O2 Saturation (%)</label>
                                <input type="number" step="0.1" class="form-control" id="oxygen_saturation" name="oxygen_saturation" value="{{ record.oxygen_saturation or '' }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="weight" class="form-label">Weight (kg)</label>
                                <input type="number" step="0.1" class="form-control" id="weight" name="weight" value="{{ record.weight or '' }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="height" class="form-label">Height (cm)</label>
                                <input type="number" step="0.1" class="form-control" id="height" name="height" value="{{ record.height or '' }}">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-info text-white"><h5 class="mb-0">Prescription & Tests</h5></div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="prescription" class="form-label">Prescription</label>
                            <textarea class="form-control font-monospace" id="prescription" name="prescription" rows="5">{{ record.prescription or '' }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label for="lab_results" class="form-label">Laboratory Results</label>
                            <textarea class="form-control" id="lab_results" name="lab_results" rows="4">{{ record.lab_results or '' }}</textarea>
                        </div>
                        <div class="mb-0">
                            <label for="imaging_results" class="form-label">Imaging Results</label>
                            <textarea class="form-control" id="imaging_results" name="imaging_results" rows="4">{{ record.imaging_results or '' }}</textarea>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-warning text-dark"><h5 class="mb-0">Follow-up</h5></div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="follow_up_required" name="follow_up_required" {{ 'checked' if record.follow_up_required }}>
                                <label class="form-check-label" for="follow_up_required">Follow-up appointment required</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="follow_up_date" class="form-label">Follow-up Date</label>
                            <input type="date" class="form-control" id="follow_up_date" name="follow_up_date" value="{{ record.follow_up_date.strftime('%Y-%m-%d') if record.follow_up_date else '' }}">
                        </div>
                        <div class="mb-0">
                            <label for="follow_up_notes" class="form-label">Follow-up Notes</label>
                            <textarea class="form-control" id="follow_up_notes" name="follow_up_notes" rows="3">{{ record.follow_up_notes or '' }}</textarea>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white"><h5 class="mb-0">Doctor Notes</h5></div>
                    <div class="card-body">
                        <textarea class="form-control" id="doctor_notes" name="doctor_notes" rows="4">{{ record.doctor_notes or '' }}</textarea>
                    </div>
                </div>

                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-warning btn-lg">
                                        <i class="bi bi-check-circle"></i> Update Record
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-grid">
                                    <a href="{{ url_for('medical.view', record_id=record.id) }}" class="btn btn-outline-secondary btn-lg">
                                        <i class="bi bi-x-circle"></i> Cancel
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
